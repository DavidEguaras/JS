<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pelotas</title>
  <style>
    canvas {
      border: 1px solid black;
    }
  </style>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>
  <button id="crearPelota">Pelopelopta</button>

  <script>
    // Clase Bola
    class Bola {
      constructor(x, y, radio, color) {
        this.x = x;
        this.y = y;
        this.radio = radio;
        this.color = color;
      }

      dibujar(contexto) {
        contexto.beginPath();
        contexto.arc(this.x, this.y, this.radio, 0, Math.PI * 2);
        contexto.fillStyle = this.color;
        contexto.fill();
        contexto.closePath();
      }
    }

    // Clase Pelota que hereda de Bola
    class Pelota extends Bola {
      constructor(x, y, radio, color, vx, vy) {
        super(x, y, radio, color);
        this.vx = vx;
        this.vy = vy;
      }

      // Método para comprobar y manejar colisiones con las paredes
      manejarColisionesParedes(anchoCanvas, altoCanvas) {
        if (this.x + this.radio >= anchoCanvas || this.x - this.radio <= 0) {
          this.vx = -this.vx; // Invertir la velocidad en el eje X
        }
        if (this.y + this.radio >= altoCanvas || this.y - this.radio <= 0) {
          this.vy = -this.vy; // Invertir la velocidad en el eje Y
        }
      }

      // Método para verificar colisiones con otras pelotas
      verificarColisionesOtrasPelotas(otrasPelotas) {
        otrasPelotas.forEach(pelota => {
          if (pelota !== this) {
            const distanciaX = this.x - pelota.x;
            const distanciaY = this.y - pelota.y;
            const distancia = Math.sqrt(distanciaX ** 2 + distanciaY ** 2);
            const sumaRadios = this.radio + pelota.radio;

            if (distancia < sumaRadios) {
              // Las pelotas están colisionando, ajustar velocidades
              const diferenciaX = distanciaX / distancia;
              const diferenciaY = distanciaY / distancia;

              this.vx += diferenciaX;
              this.vy += diferenciaY;

              pelota.vx -= diferenciaX;
              pelota.vy -= diferenciaY;
            }
          }
        });
      }

      // Método para actualizar la posición de la pelota
      actualizarPosicion() {
        this.x += this.vx;
        this.y += this.vy;
      }

      // Método para dibujar la pelota en el lienzo
      dibujar(contexto) {
        super.dibujar(contexto);
        this.actualizarPosicion();
        this.manejarColisionesParedes(contexto.canvas.width, contexto.canvas.height);
      }
    }

    // Función para crear una pelota con propiedades aleatorias
    function crearPelotaAleatoria() {
      const radio = Math.random() * 30 + 10; // Radio entre 10 y 40
      const x = Math.random() * (canvas.width - radio * 2) + radio; // Posición X aleatoria dentro del canvas
      const y = Math.random() * (canvas.height - radio * 2) + radio; // Posición Y aleatoria dentro del canvas
      const color = `rgb(${Math.random() * 256}, ${Math.random() * 256}, ${Math.random() * 256})`; // Color aleatorio
      const vx = Math.random() * 4 - 2; // Velocidad en X aleatoria entre -2 y 2
      const vy = Math.random() * 4 - 2; // Velocidad en Y aleatoria entre -2 y 2

      return new Pelota(x, y, radio, color, vx, vy);
    }

    // Inicializar el canvas y el contexto
    const canvas = document.getElementById('canvas');
    const contexto = canvas.getContext('2d');

    // Array para almacenar las pelotas
    const arrayPelotas = [];

    // Función para dibujar las pelotas en el canvas
    function dibujarPelotas() {
      contexto.clearRect(0, 0, canvas.width, canvas.height);
      arrayPelotas.forEach(pelota => {
        pelota.dibujar(contexto);
        pelota.verificarColisionesOtrasPelotas(arrayPelotas);
      });
    }

    // Función para crear una nueva pelota y agregarla al array
    function crearNuevaPelota() {
      const nuevaPelota = crearPelotaAleatoria();
      arrayPelotas.push(nuevaPelota);
    }

    // Evento clic para crear una nueva pelota
    const botonCrearPelota = document.getElementById('crearPelota');
    botonCrearPelota.addEventListener('click', crearNuevaPelota);

    // SetInterval para actualizar y dibujar las pelotas cada 20 ms
    setInterval(dibujarPelotas, 20);
  </script>
</body>
</html>
